<!doctype html>
<html lang=en-us>
<head>
<meta charset=utf-8>
<meta content="text/html; charset=utf-8" http-equiv=Content-Type>
<title>gkcjs</title>
<style>
#output {
  width: 1000px;
  height: 600px;
}
.gkc_input {
  min-width: 200px;
  min-height: 100px;
}
.gkc_output {
  min-width: 80%;
  min-height: 25px;
  white-space: pre-wrap;
  background-color: #ddd;
}

</style>
</head>
<body>
<div class=spinner id=spinner></div>
<div class=emscripten id=status></div>

<div class=emscripten><progress hidden id=progress max=100 value=0></progress></div>
<div class=emscripten_border>
<!-- <canvas class=emscripten id=canvas oncontextmenu=event.preventDefault() tabindex=-1></canvas> -->
</div>
<button onclick="gkc(['-version'])">version</button><p>
<button onclick="clearOutput('gkc_1');">clear</button><p>
<button onclick="fillOutput('gkc_1','aasas\nasasas\nffff ');">fill</button><p>
<button onclick="gkc(['-text','p(a). -p(X) | r(X). -r(a).','-json'])">prove2</button><p>
  
<div id="gkc_1">
<textarea id="gkc_1_input" class="gkc_input"></textarea><br>
<button onclick="useGkc(this)">prove</button>
<button onclick="clearOutput(this);">clear</button><p>
<div id="gkc_1_output" class="gkc_output"></div><p>
</div>

<p>

Output:<p>
<textarea id=output rows=20></textarea>

<script>
'use strict';
var gkcoutput="";

function useGkc(el) {
  var placeid;
  var input, output;
  var inputarea, outputplace;
  var arglist;

  var placeid=el.parentNode.id;
  var div = document.getElementById(placeid+"_output"); 
  clearOutputByPlace(placeid); 
  inputarea=document.getElementById(placeid+"_input");
  outputplace=document.getElementById(placeid+"_output");  
  input=inputarea.value;  
  arglist=["-text",input];
  gkcoutput="";
  gkc(arglist);
  console.log("gkcoutput",gkcoutput);
  document.getElementById(placeid+"_output").innerHTML=gkcoutput;
}  

function gkc(arglist) {
  Module.callMain(arglist);
}  

function clearOutputByPlace(placeid) { 
  var div = document.getElementById(placeid+"_output");
  while(div.firstChild){
    div.removeChild(div.firstChild);
  }
}

function clearOutput(el) { 
  var parentid=el.parentNode.id;
  clearOutputByPlace(parentid);  
}

function fillOutput(placeid,text) { 
  document.getElementById(placeid+"_output").innerHTML=text;  
}


//https://github.com/emscripten-core/emscripten/blob/1.29.12/src/shell.html#L1220

// simplified Module glue code originally produced by emscripten

var Module={
  //arguments:["-version"],      
  noInitialRun: true,
  
  preRun:[],
  postRun:[],
  print: function(s) {
    console.log("s",s);
    gkcoutput+=s+"\n";
    //document.getElementById("gkc_1_output").innerHTML=s;
  },
  /*
  print:function(){
    var res="";
    var place=document.getElementById("gkc_1_output");
    place.innerHTML=e;
    var e=document.getElementById("output");    
    return e && (e.value=""),
    function(t){
      console.log("arguments",arguments);
      arguments.length>1 && (t=Array.prototype.slice.call(arguments).join(" ")),
      console.log("t",t),
      res=res+t;
      e&&(e.value+=t+"\n",e.scrollTop=e.scrollHeight)
    }
    
  }(),
  */
  printErr:function(e){
    arguments.length>1 && (e=Array.prototype.slice.call(arguments).join(" ")),
    console.log("es",JSON.stringify(e));
    if ((JSON.stringify(e)).includes("abort(OOM)")) {
      location.reload();
    }
    console.error(e);    
  },
  setStatus:function(e){ return 1 },
  totalDependencies:0,
  monitorRunDependencies:function(e){
    this.totalDependencies=0; 
    Module.setStatus(e ? "Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")"
                    :
                    "All downloads complete.")
  }
};

window.onerror=function(e){
  Module.setStatus("Exception thrown, see JavaScript console"),
  Module.setStatus=function(e){
    e &&
    Module.printErr("[post-exception status] "+e)
  }
}
</script>
<script async src="gkcjs.js">
</script>
</body>
</html>
